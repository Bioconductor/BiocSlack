---
title: "Slack channels"
subtitle: "Explore our Slack channels at [https://slack.bioconductor.org/](https://slack.bioconductor.org/) and join conversations that interest you. Our table below lists all public channels, updated daily, showing the date of the last activity, whether it's a message or thread reply. These channels are open to everyone interested in Bioconductor to participate and learn together."
date: now
date-format: "DD MMMM YYYY, HH:mm[Z]"
format: 
  html: 
    template-partials:
      - title-block.html
    grid:
      sidebar-width: 0px
      body-width: 2000px
      margin-width: 0px
      gutter-width: 1.5rem
editor: visual
execute:
  message: false
  warning: false
  echo: false
  cache: true
css: styles.css
---

```{r}
library(slackr)
library(dplyr)
library(tidyr)
library(lubridate)
library(purrr)
library(reactable)
```

```{r}
# Get list of all public Bioc slack channels

sc <- slackr_channels(token = Sys.getenv("SLACK_TOKEN"), exclude_archived = TRUE) |>
  filter(!is_private) |>
  unnest(cols = c(topic, purpose), names_sep = "_") |>
  # convert UNIX timestamp in milliseconds to date
  mutate(created = as_date(as_datetime(created))) |>
  select(id, name, topic_value, purpose_value, created, num_members)
```

```{r}
# Get message history from the list of public channels

sm <-
  map_dfr(
    .x = set_names(sc$id),
    .f = ~ slackr_history(channel = .x, token = Sys.getenv("SLACK_TOKEN"), message_count = 100),
    .id = "id"
  )
```

```{r}
# Get the latest message for each public channel

sm_latest <- sm %>%
  filter(is.na(subtype) | subtype %in% c("thread_broadcast", "bot_message")) %>%
  separate(ts, c("ts_formatted", NA)) %>%
  mutate(
    # Latest message in main channel
    latest = as_datetime(as.integer(ts_formatted), tz = "UTC"),
    # Latest thread reply message
    latest_reply = as_datetime(as.integer(root$latest_reply), tz = "UTC"), 
    # Determine the latest between the two
    final_latest = pmax(latest, latest_reply, na.rm = TRUE),
    # Format final_latest in a human-friendly UTC format
    `Last Activity` = format(final_latest, "%Y-%m-%d %H:%M %Z")
  ) %>%
  group_by(id) %>%
  slice_max(final_latest) %>%
  ungroup()
```

```{r}
# Add the latest message date to the channel info

all <- left_join(sc, sm_latest, by = "id") |>
  select(name.x, topic_value, purpose_value, num_members, created, `Last Activity`) |>
  rename(Name = name.x, Topic = topic_value, Description = purpose_value, `Number of Members` = num_members, `Created` = created)
```

```{r}
# Output searchable table of channel info

all |>
  reactable(
    columns = list(
      Topic = colDef(minWidth = 300),
      Description = colDef(minWidth = 300),
      `Last Activity` = colDef(defaultSortOrder = "desc")
    ),
    outlined = TRUE,
    bordered = TRUE,
    resizable = TRUE,
    striped = TRUE,
    searchable = TRUE,
    defaultPageSize = 200
  )
```

[![](https://github.githubassets.com/favicon.ico)](https://github.com/mblue9/BiocSlack)
